<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Poco | Token Config</title>
</head>
<body class="bg-[#0f172a] text-white p-4">
    <div class="flex items-center gap-3 mb-6">
        <button onclick="window.history.back()" class="text-blue-500 text-xl">←</button>
        <h1 class="text-xl font-bold italic">Token Identity</h1>
    </div>

    <div class="bg-gray-800 p-5 rounded-2xl border border-gray-700 mb-6">
        <p class="text-xs font-bold text-gray-400 mb-3 uppercase">Contract Address (CA)</p>
        <div class="flex flex-col gap-3">
            <input id="ca-input" type="text" placeholder="Enter CA..." 
                   class="bg-black/30 border border-gray-600 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
            <button onclick="verifyCA()" id="verify-btn" class="bg-blue-600 py-3 rounded-xl font-bold active:scale-95 transition">Verify on Dex</button>
        </div>
    </div>

    <div id="meta-card" class="hidden bg-gray-800 p-5 rounded-2xl border border-gray-700 animate-pulse">
        <div class="flex justify-between items-center mb-4">
            <h3 id="meta-ticker" class="text-2xl font-black text-blue-400">$LOADING</h3>
            <span id="meta-chain" class="bg-blue-900/50 text-blue-300 text-[10px] px-2 py-1 rounded-md font-bold">CHAIN</span>
        </div>
        <div class="space-y-2 text-sm text-gray-300">
            <p id="meta-links">Links: Fetching...</p>
        </div>
        <button onclick="saveConfig()" class="w-full mt-6 bg-green-600 py-3 rounded-xl font-bold shadow-lg shadow-green-900/20">Apply Configuration</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentMetadata = null;

        async function verifyCA() {
            const ca = document.getElementById('ca-input').value;
            if(!ca) return;
            
            tg.HapticFeedback.impactOccurred('light');
            document.getElementById('verify-btn').innerText = "Searching Dex...";
            
            try {
                // We talk to our own API which hits DexScreener
                const res = await fetch(`https://your-api.com/token/verify?ca=${ca}`);
                const data = await res.json();
                
                document.getElementById('meta-card').classList.remove('hidden', 'animate-pulse');
                document.getElementById('meta-ticker').innerText = `$${data.ticker}`;
                document.getElementById('meta-chain').innerText = data.chain_name;
                document.getElementById('meta-links').innerText = `TG: ${data.tg_url ? '✅' : '❌'} | X: ${data.x_url ? '✅' : '❌'}`;
                currentMetadata = data;
            } catch (e) {
                alert("Token not found. Check the CA.");
            } finally {
                document.getElementById('verify-btn').innerText = "Verify on Dex";
            }
        }

        async function saveConfig() {
            tg.HapticFeedback.notificationOccurred('success');
            const res = await fetch(`https://your-api.com/token/set`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: tg.initDataUnsafe.chat?.id,
                    ca: document.getElementById('ca-input').value
                })
            });
            if(res.ok) tg.close();
        }
    </script>
</body>
</html>